<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="m-0">Transfer Money</h3>
      <a class="btn btn-light btn-sm" [routerLink]="['/profile']">← Back to Profile</a>
    </div>

    <form #f="ngForm" (ngSubmit)="submit(f)" class="card p-3 shadow-soft">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">From Account ID</label>
          <input class="form-control"
                 type="text"
                 name="fromAccountId"
                 [(ngModel)]="fromAccountId"
                 required />
        </div>

        <div class="col-md-4">
          <label class="form-label">To Account ID <span class="text-danger">*</span></label>
          <div class="input-group">
            <input class="form-control"
                   type="text"
                   name="toAccountId"
                   [(ngModel)]="toAccountId"
                   (blur)="verifyToAccount()"
                   (change)="verifyToAccount()"
                   required />
            <button class="btn btn-outline-secondary" type="button" (click)="verifyToAccount()" [disabled]="verifyingAccount">
              {{ verifyingAccount ? 'Verifying...' : 'Verify' }}
            </button>
          </div>
          <small *ngIf="toAccountVerified" class="text-success d-block mt-1">
            ✓ {{ toAccountHolderName }}
          </small>
          <small *ngIf="!toAccountVerified && toAccountId" class="text-danger d-block mt-1">
            Account not verified
          </small>
        </div>

        <div class="col-md-4">
          <label class="form-label">Amount</label>
          <input class="form-control amount-input"
                 type="number"
                 name="amount"
                 [(ngModel)]="amount"
                 step="0.01"
                 min="0.01"
                 [disabled]="!toAccountVerified"
                 required />
          <small *ngIf="!toAccountVerified" class="text-muted d-block mt-1">
            Verify account to enter amount
          </small>
        </div>
      </div>

      <div class="mt-3 d-flex gap-2 align-items-center">
        <button class="btn btn-primary" type="submit" [disabled]="f.invalid || loading || !toAccountVerified">
          {{ loading ? 'Sending…' : 'Send' }}
        </button>

        <a class="btn btn-outline-secondary"
           [routerLink]="['/transactions']"
           [queryParams]="{ accountId: fromAccountId }">
          View History
        </a>
      </div>

      <div *ngIf="errorMsg" class="alert alert-danger mt-3">{{ errorMsg }}</div>
      <div *ngIf="successMsg" class="alert alert-success mt-3">
        <div class="fw-semibold mb-1">Transfer initiated</div>
        <div>Transaction ID: {{ lastResponse?.transactionId }}</div>
        <div>Status: {{ lastResponse?.status }}</div>
        <div class="text-muted">{{ lastResponse?.message }}</div>
      </div>
    </form>
  </div>
